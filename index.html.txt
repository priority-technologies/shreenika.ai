<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Voice Agent Demo</title>
  <style>
    body{font-family:Arial; padding:20px}
    button{padding:10px 16px; margin-right:8px}
    #status{margin-top:12px;font-weight:bold}
  </style>
</head>
<body>
  <h2>Voice Agent Demo</h2>
  <button id="startBtn">Start</button>
  <button id="stopBtn" disabled>Stop</button>
  <p id="status">Status: Idle</p>

<script>
const AGENT_ID = "YOUR_AGENT_ID_HERE"; // Replace with your Agent ID

let pc;
let userStream;

function setStatus(msg) {
  document.getElementById("status").innerText = "Status: " + msg;
}

document.getElementById("startBtn").onclick = async () => {
  setStatus("Starting session...");

  pc = new RTCPeerConnection();

  pc.ontrack = (event) => {
    const audio = document.createElement("audio");
    audio.autoplay = true;
    audio.srcObject = event.streams[0];
  };

  userStream = await navigator.mediaDevices.getUserMedia({ audio: true });
  userStream.getTracks().forEach(t => pc.addTrack(t, userStream));

  const offer = await pc.createOffer();
  await pc.setLocalDescription(offer);

  const resp = await fetch("/api/realtime", {
    method: "POST",
    headers: { "Content-Type": "application/sdp" },
    body: offer.sdp
  });

  const answerSDP = await resp.text();

  await pc.setRemoteDescription({
    type: "answer",
    sdp: answerSDP
  });

  setStatus("Listening...");
  document.getElementById("startBtn").disabled = true;
  document.getElementById("stopBtn").disabled = false;
};

document.getElementById("stopBtn").onclick = () => {
  if (pc) pc.close();
  if (userStream) userStream.getTracks().forEach(t => t.stop());
  setStatus("Stopped");
  document.getElementById("startBtn").disabled = false;
  document.getElementById("stopBtn").disabled = true;
};
</script>
</body>
</html>
